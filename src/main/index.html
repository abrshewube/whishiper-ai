<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chrome Browser</title>
  <link rel="stylesheet" href="../renderer/styles.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background: #f5f5f5;
    }

    /* Draggable Title Bar */
    .title-bar {
      height: 32px;
      background: #e8e8e8;
      border-bottom: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      -webkit-app-region: drag;
      user-select: none;
    }

    .title-bar-text {
      font-size: 13px;
      color: #333;
      font-weight: 500;
    }

    /* Tab Bar */
    .tab-bar {
      display: flex;
      background: #f0f0f0;
      border-bottom: 1px solid #ccc;
      height: 36px;
      align-items: center;
      padding-left: 8px;
      overflow-x: auto;
    }

    .tab {
      display: flex;
      align-items: center;
      padding: 8px 24px 8px 32px;
      background: #e8e8e8;
      border: 1px solid #ccc;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      margin-right: 2px;
      max-width: 250px;
      min-width: 120px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tab:hover {
      background: #f0f0f0;
    }

    .tab.active {
      background: white;
      border-bottom: 1px solid white;
      z-index: 10;
    }

    .tab-close {
      position: absolute;
      right: 8px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
      opacity: 0;
      transition: opacity 0.2s, background 0.2s;
    }

    .tab:hover .tab-close {
      opacity: 1;
    }

    .tab-close:hover {
      background: #c0c0c0;
    }

    .tab-title {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
      font-size: 13px;
      color: #333;
    }

    .new-tab-button {
      width: 32px;
      height: 24px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 18px;
      color: #666;
      margin-left: 4px;
    }

    .new-tab-button:hover {
      background: #ddd;
      border-radius: 4px;
    }

    /* Navigation Bar */
    .nav-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: white;
      border-bottom: 1px solid #ccc;
    }

    .nav-button {
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .nav-button:hover:not(:disabled) {
      background: #f0f0f0;
    }

    .nav-button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .nav-button, .new-tab-button, .tab, .tab-close, .url-input, .url-container {
      -webkit-app-region: no-drag;
    }

    .url-container {
      flex: 1;
      display: flex;
      align-items: center;
      background: #f5f5f5;
      border-radius: 24px;
      padding: 8px 16px;
      border: 1px solid transparent;
      transition: all 0.2s;
    }

    .url-container:focus-within {
      background: white;
      border-color: #4285f4;
      box-shadow: 0 0 0 1px #4285f4;
    }

    .url-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 14px;
      color: #333;
    }

    /* Content Area */
    .content-area {
      position: relative;
      height: calc(100vh - 112px);
    }

    .webview-container {
      width: 100%;
      height: 100%;
      display: none;
    }

    .webview-container.active {
      display: block;
    }

    webview {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div class="title-bar">
    <div class="title-bar-text">Chrome Browser</div>
  </div>

  <div class="tab-bar" id="tabBar">
    <!-- Tabs will be created dynamically -->
    </div>

  <div class="nav-bar">
    <button class="nav-button" id="backBtn" title="Back">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M12.5 15l-5-5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    <button class="nav-button" id="forwardBtn" title="Forward">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M7.5 15l5-5-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
    <button class="nav-button" id="refreshBtn" title="Refresh">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M10 3v5h5M10 17v-5H5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    <div class="url-container">
      <input type="text" class="url-input" id="urlInput" value="https://www.google.com" />
    </div>
    </div>

  <div class="content-area" id="contentArea">
    <!-- Web views will be created dynamically -->
  </div>

  <script>
    let tabs = [];
    let activeTabIndex = 0;

    // Create first tab
    function createTab(url = 'https://www.google.com', title = 'New Tab') {
      const tabId = tabs.length;
      
      // Create tab
      const tab = document.createElement('div');
      tab.className = 'tab active';
      tab.dataset.tabId = tabId;
      
      const tabTitle = document.createElement('span');
      tabTitle.className = 'tab-title';
      tabTitle.textContent = title;
      
      const closeBtn = document.createElement('div');
      closeBtn.className = 'tab-close';
      closeBtn.textContent = 'Ã—';
      closeBtn.onclick = (e) => {
        e.stopPropagation();
        closeTab(tabId);
      };
      
      tab.appendChild(tabTitle);
      tab.appendChild(closeBtn);
      
      const newTabBtn = document.getElementById('tabBar').querySelector('.new-tab-button');
      document.getElementById('tabBar').insertBefore(tab, newTabBtn);
      
      // Create content
      const container = document.createElement('div');
      container.className = 'webview-container active';
      container.dataset.tabId = tabId;
      
      const webview = document.createElement('webview');
      webview.src = url;
      webview.setAttribute('allowpopups', 'true');
      webview.setAttribute('preload', '');
      
      // Track URL changes in webview
      webview.addEventListener('did-navigate', (event) => {
        const activeTab = tabs.find(t => t.webview === webview);
        if (activeTab) {
          activeTab.url = event.url;
          if (activeTab.id === activeTabIndex) {
            document.getElementById('urlInput').value = event.url;
          }
        }
      });
      
      webview.addEventListener('did-navigate-in-page', (event) => {
        const activeTab = tabs.find(t => t.webview === webview);
        if (activeTab) {
          activeTab.url = event.url;
          if (activeTab.id === activeTabIndex) {
            document.getElementById('urlInput').value = event.url;
          }
        }
      });
      
      webview.addEventListener('page-title-updated', (event) => {
        const activeTab = tabs.find(t => t.webview === webview);
        if (activeTab && event.title) {
          activeTab.title = event.title;
          activeTab.element.querySelector('.tab-title').textContent = event.title;
        }
      });
      
      container.appendChild(webview);
      document.getElementById('contentArea').appendChild(container);
      
      tabs.push({
        id: tabId,
        url: url,
        title: title,
        element: tab,
        container: container,
        webview: webview,
        canGoBack: false,
        canGoForward: false,
        history: [url]
      });
      
      // Update active tab
      updateActiveTab(tabId);
      
      // Add click handler
      tab.onclick = () => switchToTab(tabId);
      
      return tabId;
    }

    function switchToTab(tabId) {
      // Update tab elements
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.webview-container').forEach(c => c.classList.remove('active'));
      
      const tab = tabs[tabId];
      if (tab) {
        tab.element.classList.add('active');
        tab.container.classList.add('active');
        activeTabIndex = tabId;
        
        // Get current URL from webview
        let currentUrl = tab.url;
        try {
          // Try to get URL from webview if it's loaded
          if (tab.webview && tab.webview.getURL) {
            const webviewUrl = tab.webview.getURL();
            if (webviewUrl && webviewUrl !== 'about:blank') {
              currentUrl = webviewUrl;
            }
          }
        } catch (e) {
          // Use stored URL if webview not ready
        }
        
        // Update URL bar
        document.getElementById('urlInput').value = currentUrl;
        
        // Update navigation buttons
        updateNavigationButtons();
      }
    }

    function closeTab(tabId) {
      if (tabs.length === 1) {
        // Don't close the last tab
        return;
      }
      
      const tab = tabs[tabId];
      if (tab) {
        tab.element.remove();
        tab.container.remove();
        tabs.splice(tabId, 1);
        
        // Update tab IDs
        tabs.forEach((t, i) => {
          t.id = i;
          t.element.dataset.tabId = i;
          t.container.dataset.tabId = i;
        });
        
        // Switch to another tab
        const newActiveIndex = tabId === activeTabIndex ? 
          Math.max(0, activeTabIndex - 1) : 
          tabs.findIndex(t => t.id === activeTabIndex);
        
        if (newActiveIndex >= 0 && newActiveIndex < tabs.length) {
          switchToTab(newActiveIndex);
        }
      }
    }

    function updateActiveTab(tabId) {
      activeTabIndex = tabId;
      switchToTab(tabId);
    }

    function updateNavigationButtons() {
      const tab = tabs[activeTabIndex];
      if (tab) {
        document.getElementById('backBtn').disabled = !tab.canGoBack;
        document.getElementById('forwardBtn').disabled = !tab.canGoForward;
      }
    }

    function navigate(url) {
      if (!url) return;
      
      // Add http:// if no protocol
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }
      
      const tab = tabs[activeTabIndex];
      if (tab) {
        tab.url = url;
        tab.webview.src = url;
        document.getElementById('urlInput').value = url;
        tab.history.push(url);
      }
    }

    // Event listeners
    document.getElementById('backBtn').onclick = () => {
      const tab = tabs[activeTabIndex];
      if (tab && tab.history.length > 1) {
        tab.history.pop(); // Remove current
        const prevUrl = tab.history[tab.history.length - 1];
        tab.url = prevUrl;
        tab.webview.src = prevUrl;
        document.getElementById('urlInput').value = prevUrl;
      }
    };

    document.getElementById('forwardBtn').onclick = () => {
      // Forward navigation would require maintaining forward history
      // Simplified implementation
    };

    document.getElementById('refreshBtn').onclick = () => {
      const tab = tabs[activeTabIndex];
      if (tab) {
        tab.webview.reload();
      }
    };

    document.getElementById('urlInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        navigate(e.target.value);
      }
    });

    // New tab button
    const newTabBtn = document.createElement('button');
    newTabBtn.className = 'new-tab-button';
    newTabBtn.textContent = '+';
    newTabBtn.title = 'New Tab';
    newTabBtn.onclick = () => createTab('https://www.google.com', 'New Tab');
    document.getElementById('tabBar').appendChild(newTabBtn);

    // Create initial tab
    createTab('https://www.google.com', 'Google');
  </script>
</body>
</html>
